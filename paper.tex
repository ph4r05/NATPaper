\documentclass[twoside]{article}


% ------
% Fonts and typesetting settings
\usepackage[sc]{mathpazo}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\linespread{1.05} % Palatino needs more space between lines
\usepackage{microtype}


% ------
% Page layout
\usepackage[hmarginratio=1:1,top=32mm,columnsep=20pt]{geometry}
\usepackage[font=it]{caption}
\usepackage{paralist}
\usepackage{multicol}

% ------
% Lettrines
\usepackage{lettrine}


% ------
% Abstract
\usepackage{abstract}
	\renewcommand{\abstractnamefont}{\normalfont\bfseries}
	\renewcommand{\abstracttextfont}{\normalfont\small\itshape}


% ------
% Titling (section/subsection)
\usepackage{titlesec}
\renewcommand\thesection{\Roman{section}}
\titleformat{\section}[block]{\large\scshape\centering}{\thesection.}{1em}{}


% ------
% Header/footer
\usepackage{fancyhdr}
	\pagestyle{fancy}
	\fancyhead{}
	\fancyfoot{}
	\fancyhead[C]{Security Protocol Workshop $\bullet$ March 2014 $\bullet$ Vol 1}
	\fancyfoot[RO,LE]{\thepage}


% ------
% Clickable URLs (optional)
\usepackage{hyperref}


% ------
% BibTex for bibliography
\usepackage[numbers]{natbib}
%\usepackage[square,sort&compress,authoryear]{natbib}

% ------
% Math
\usepackage{amsthm}
\usepackage{amsmath, mathtools}
\usepackage{fixltx2e}
\newtheorem{mydef}{Definition}
\newcommand{\ignore}[1]{}
% \setlength{\parskip}{0cm plus4mm minus3mm}

% ------
% Maketitle metadata
\title{\vspace{-15mm}%
	\fontsize{24pt}{10pt}\selectfont
	\textbf{Traversing Symmetric NAT with predictable port allocation function}
	}	
\author{%
	\large
	\textsc{Du\v{s}an Klinec} \\[2mm]%\thanks{Template by \href{http://www.howtotex.com}{howtoTeX.com}} \\[2mm]
	\normalsize	Faculty of Informatics \\
	\normalsize	Masaryk University, Brno \\
	\normalsize	\href{mailto:xklinec@mail.muni.cz}{xklinec@mail.muni.cz}
	\and
	\textsc{Vashek Matyáš} \\[2mm]%\thanks{Template by \href{http://www.howtotex.com}{howtoTeX.com}} \\[2mm]
	\normalsize	Faculty of Informatics \\
	\normalsize	Masaryk University, Brno \\
	\normalsize	\href{mailto:matyas@mail.muni.cz}{matyas@mail.muni.cz}
	\vspace{-5mm}
	}
\date{}



%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\maketitle
\thispagestyle{fancy}

\begin{abstract}
\noindent ToDo; Will be written as the last part of the paper... Lorem ipsum dolor sit amet, consectetur adipiscing elit. Curabitur magna lorem, tempor sed facilisis vel, porta et turpis. Sed et felis a massa dictum posuere. Aliquam hendrerit rhoncus ipsum sit amet placerat. Duis fringilla est eu arcu mollis faucibus non sit amet eros. Vestibulum risus nibh, dapibus vitae laoreet eget, fringilla quis nisl. Proin consequat nibh sit amet mauris suscipit tincidunt. Sed rutrum, purus nec aliquam faucibus, quam libero venenatis nisi, ut tempor mi sapien vel diam. Pellentesque sagittis elit non risus malesuada accumsan. Morbi consequat urna.
\end{abstract}
	

\begin{multicols}{2}
% \lettrine[nindent=0em,lines=3]{L}orem ipsum dolor sit amet. 

\section{Introduction}
Network Address Translators (abbreviated as NAT) has been increasing in popularity in recent years 
mainly due to IPv4 address space depletion, in order to slow it down. On one side NAT offers
the ability to share a public, globally routable IP address among many internal network hosts but on 
the other side it often breaks basic end-to-end principle of the Internet and thus favors server-client 
communication model for clients connected behind NAT.

In many applications is peer-to-peer (P2P) connection of crucial importance and the quality of a service depends on 
it's parameters heavily. Main motivation for this work is Voice-over-IP (VoIP) where direct connection 
between communicating parties is necessary. If P2P connection is not possible to be established relay 
servers has to be used (TURN~\citep{rfc5766} protocol is used). The presence 
of another node in the communication path can have negative effects on a communication channel quality 
(increased latency, jitter, lower bandwidth), relay server is a potential point of failure, 
has to scale with increasing demands of the network, interesting point for attack, etc.
Thus relay servers require non-negligible resources what makes them expensive for VoIP providers and
establishing a direct connection between parties is of high importance.

In this paper we are focused on a symmetric NAT with a predictable port allocation function. We propose 
new algorithms for establishing direct connection between hosts behind such NATs that are effective and 
has low system requirements.

\section{Network Address Translation}
The notation we will be using for the rest of the paper follows.

% \paragraph{Notation.}
% Symmetric NAT could be defined as follows.

\begin{mydef}
\begin{align*}
\mathbb{SC} = \mathbb{IP} \times \mathbb{PORT}
\end{align*} is a Socket. $\mathbb{IP}$ is set of all possible IP addresses and $\mathbb{PORT}$ 
is set of all possible ports, basically $\mathbb{PORT} = \{1,2,\dots,65535\}$.
\begin{align*}
\mathbb{SP} = \mathbb{IP} \times \mathbb{PORT} \times \mathbb{IP} \times \mathbb{PORT}
\end{align*} is a Socket Pair.
\end{mydef}
% 
% \begin{mydef}
% \begin{align*}
% \mathbb{AT} \subseteq \mathbb{SP} \times \mathbb{PORT}
% \end{align*} is an allocation table of the NAT. Second component is external port allocated for particular socket pair.
% \end{mydef}
% Allocation table is a set of all socket pairs and corresponding allocated external port.

\paragraph{NAT and communication.}
NAT connects two networks, denoted as an internal and an external, connected to an internal and an external NAT interface respectively.
Hosts has addresses $\text{IP\textsubscript{in}} \in \mathbb{IP}_{in} \subseteq \mathbb{IP}$ 
and $\text{IP\textsubscript{ex}} \in \mathbb{IP}_{ex} \subseteq \mathbb{IP}$ in the internal and the external network
respectively, $\mathbb{IP}_{in} \cap \mathbb{IP}_{ex} = \emptyset$.
If it is not said otherwise the external NAT address\footnote{We assume NAT has only one external address for simplicity.} is denoted as 
$\text{IP\textsubscript{nat}} \in \mathbb{IP}_{ex}$.

Packet received on the external interface has socket pair {(IP\textsubscript{ex},PORT\textsubscript{ex},IP\textsubscript{nat},PORT\textsubscript{nat})}.

Packet received on the internal interface has socket pair {(IP\textsubscript{in},PORT\textsubscript{in},IP\textsubscript{ex},PORT\textsubscript{ex})}.

% \paragraph{Filtering rule.} Let assume packet with socket pair {(IP\textsubscript{out},PORT\textsubscript{out},IP\textsubscript{ex},PORT\textsubscript{ex})} 
% received on NAT external interface (we'll use this notation in further text). Packet is allowed to pass to internal network iff 
% \begin{align*}
% &  \exists \; \text{IP\textsubscript{in}} \in \mathbb{IP}, \; \text{PORT\textsubscript{in}} \in \mathbb{PORT}:\\
% & ((\text{IP\textsubscript{in}}, \text{PORT\textsubscript{in}}, \text{IP\textsubscript{out}}, \text{PORT\textsubscript{out}}), \text{PORT\textsubscript{ex}} ) \in \mathbb{AT}
% \end{align*}
% 
% If packet is allowed to pass, it is then forwarded to host {(IP\textsubscript{in}, PORT\textsubscript{in})}. A new record 
% to the allocation table is added when internal host sends packet to the external host. 
% 
% \paragraph{Allocation rule.} ToDo

\subsection{NAT classes}
NAT is classified w.r.t. \emph{filtering rule} and \emph{allocation rule} which says what happens after receiving
packet from an external and an internal network respectively.

Common NAT categorization is according to~\citep{rfc3489}: a) Full Cone
b) IP Restricted Cone, c) Port Restricted Cone, d) Symmetric.

\paragraph{Full cone NAT.} ~\\
Allocation table $\mathbb{AT} \subseteq \{ \mathbb{IP}_{in} \times \mathbb{PORT} \} \times \mathbb{PORT}$ holds associations between internal 
hosts socket and mapped external NAT port. 
% Rule is created once the connection from the internal host is initiated to an arbitrary external address.
Filtering rule is
\begin{align*}
& PASS((\text{IP\textsubscript{ex}}, \text{PORT\textsubscript{ex}}, \text{IP\textsubscript{nat}}, \text{PORT\textsubscript{nat}} )) \Leftrightarrow \\
&  \exists \; \text{IP\textsubscript{in}} \in \mathbb{IP}_{in}, \; \text{PORT\textsubscript{in}} \in \mathbb{PORT}:\\
& ((\text{IP\textsubscript{in}}, \text{PORT\textsubscript{in}}), \text{PORT\textsubscript{nat}} ) \in \mathbb{AT}
\end{align*}
 
\paragraph{Address restricted cone NAT.} ~\\
Allocation table $\mathbb{AT} \subseteq \{\mathbb{IP}_{in} \times \mathbb{PORT} \times \mathbb{IP}_{ex}\} \times \mathbb{PORT}$ 
holds associations between internal hosts socket, external host IP address and mapped external NAT port. 
% Rule is created once the connection from the internal host is initiated to an arbitrary external address.
Filtering rule is
\begin{align*}
& PASS((\text{IP\textsubscript{ex}}, \text{PORT\textsubscript{ex}}, \text{IP\textsubscript{nat}}, \text{PORT\textsubscript{nat}} )) \Leftrightarrow \\
&  \exists \; \text{IP\textsubscript{in}} \in \mathbb{IP}, \; \text{PORT\textsubscript{in}} \in \mathbb{PORT}:\\
& ((\text{IP\textsubscript{in}}, \text{PORT\textsubscript{in}}, \text{IP\textsubscript{ex}}), \text{PORT\textsubscript{nat}} ) \in \mathbb{AT}
\end{align*}

\paragraph{Port restricted cone NAT.} ~\\
Allocation table $\mathbb{AT} \subseteq \{\mathbb{IP}_{in} \times \mathbb{PORT} \times \mathbb{IP}_{ex} \times \mathbb{PORT}\} \times \mathbb{PORT}$ 
holds associations between internal hosts socket, external host socket and mapped external NAT port. 
% Rule is created once the connection from the internal host is initiated to an arbitrary external address.
Filtering rule is
\begin{align*}
& PASS((\text{IP\textsubscript{out}}, \text{PORT\textsubscript{out}}, \text{IP\textsubscript{nat}}, \text{PORT\textsubscript{nat}} )) \Leftrightarrow \\
&  \exists \; \text{IP\textsubscript{in}} \in \mathbb{IP}, \; \text{PORT\textsubscript{in}} \in \mathbb{PORT}:\\
& ((\text{IP\textsubscript{in}}, \text{PORT\textsubscript{in}}, \text{IP\textsubscript{ex}}, \text{PORT\textsubscript{ex}}), \text{PORT\textsubscript{nat}} ) \in \mathbb{AT}
\end{align*}

\paragraph{Symmetric NAT.} ~\\
Allocation table $\mathbb{AT}$ and filtering rule is the same as in Port restricted Cone NAT. The difference lies in the way 
the new entries in the allocation table are created. For Cone NAT holds that multiple entries in the allocation table 
can have the same external port assigned, while Symmetric NAT creates new an allocation entries under some circumstances.

\emph{Allocation function (AF)} says how is the port allocated for new connection chosen. Assume $\mathbb{AT}=\emptyset$, for simplicity. 
AF can be \emph{predictable}, e.g. \emph{incremental}. If previously allocated port was $\text{PORT\textsubscript{nat}}$
the next port will be $\text{PORT\textsubscript{nat}}+\Delta$, where $\Delta=1$ usually. Another type of AF is \emph{random}.
If the chosen port is already taken, AF iterates until the free one is found.

AF can have different \emph{sensitivity} determining the cases where new allocation is created or the previous one is used instead.

\emph{Address sensitive allocation function} creates new allocation if a destination address differs from the existing allocation 
from the same source:
\begin{align*}
& \exists s=(a_1,a_2,a_3,a_4) \in \mathbb{SP}, p \in \mathbb{PORT}: \\
& (s, p) \in \mathbb{AT} \Rightarrow ((\forall s^{\prime}=(a_1^{\prime},a_2^{\prime},a_3^{\prime},a_4^{\prime}) \in \mathbb{SP}, \\
& a_1 \neq a_1^{\prime}, a_2 \neq a_2^{\prime}, a_3 \neq a_3^{\prime}, \forall p^{\prime} \in \mathbb{PORT}: \\
& ((s^{\prime}, p^{\prime}) \in \mathbb{AT})) \Rightarrow p \neq p^{\prime})
\end{align*}

\emph{Port sensitive allocation function} creates new allocation if a destination address and a port differs from the existing
allocations from the same source\footnote{for each new connection is allocated new a NAT port.}:
\begin{align*}
& \exists s \in \mathbb{SP}, p \in \mathbb{PORT}: (s, p) \in \mathbb{AT} \Rightarrow \\
& \Rightarrow ((\forall s^{\prime} \in \mathbb{SP}, s^{\prime} \neq s , \forall p^{\prime} \in \mathbb{PORT}: \\
& ((s^{\prime}, p^{\prime}) \in \mathbb{AT})) \Rightarrow p \neq p^{\prime})
\end{align*}

% 
%     PASS((\text{IP\textsubscript{out}}, \text{PORT\textsubscript{out}}, \text{IP\textsubscript{ex}}, \text{PORT\textsubscript{ex}} )) \Leftrightarrow \\
% &  \exists \; \text{IP\textsubscript{in}} \in \mathbb{IP}, \; \text{PORT\textsubscript{in}} \in \mathbb{PORT}:\\
% & ((\text{IP\textsubscript{in}}, \text{PORT\textsubscript{in}}, \text{IP\textsubscript{out}}, \text{PORT\textsubscript{out}}), \text{PORT\textsubscript{ex}} ) \in \mathbb{AT}
% \end{align*}

% 
%We mainly categorize NATs from two perspectives a) 
% 
% Hola hop, hola hop, he-ja he-ja hej rup. Hola hop, hola hop, he-ja he-ja hej rup.
% \begin{compactitem}
% \item STUN~\citep{rfc5389}
% \item TURN~\citep{rfc5766}
% \item Teredo~\citep{rfc4380}
% \item uPNP~\citep{rfc6970}
% \item PCP~\citep{rfc6887}
% \item ICE~\citep{rfc5245}
% \end{compactitem}
% 

% Properties of NAT assumed in our work:
% \begin{compactitem}
% \item symmetric
% \item port-restricted firewall
% \item port-sensitive allocation
% \item incremental port allocation rule
% \end{compactitem}

\section{Existing techniques}
Many different solutions for traversing non-symmetric NATs exist e.g., NAT traversal in Internet Key Exchange~\citep{rfc3947} or Terredo\ignore{tunneling}~\citep{rfc4380}.

Some devices with NAT functionality provide special interface enabling traversal, for example NAT Port Mapping Protocol~\citep{rfc6886}. But in general 
it is not widely deployed and it cannot be relied upon. 

Most of the applications use Interactive Connectivity Establishment~(ICE)~\citep{rfc5245} nowadays, what is a very powerful toolbox for traversing 
various types of NAT, however does not work with symmetric NATs. ICE mainly uses STUN~\citep{rfc5389} and TURN~\citep{rfc5766} for it's operation.

\section{Related work}
Some interesting algorithms for traversing symmetric NAT were proposed by Y. Takeda in \citep{takeda}, but the case both clients are behind symmetric NAT
with port sensitive allocation function is not covered. It mentions that sending more packets won't increase probability of establishing the new connection.
Our motivation is to show that it is actually possible.

The \citep{rfc5128} maps current state of the art in NAT traversal. But does not cover our case.

Also the academic research was done in this field, for example by Wei~\emph{et.~al.} in \citep{wei}., but their algorithm is using another technique compared
to our approach. The downside of their algorithm is it requires Time To Live~(TTL) modification of the IP~packet. This is in majority of cases considered
as a privileged operation in operating system and sufficient privileges are required for this modification. 

In our work we study the situation where two parties, A,B tries to establish a direct connection, both of them are behind 
a symmetric NAT (possibly cascade of such NATs) with port sensitive, predictable allocation function. Another scenarios with
predictable allocation function are quite easy to solve and covered in previous research. 

% \section{Related work II}
% \begin{compactitem}
% \item chineese\citep{Wang:2006:RSN:1156422.1156550}
% \item uPNP
% \item PCP~\citep{rfc6887}
% \end{compactitem}

\section{UDP hole punching with STUN}
All algorithms here make use of the same principle, \emph{UDP hole punching}. 
Internet hosts cannot send packet to the internal host directly. 
Communication has to be initiated from the inside\footnote{Ignoring 
pre-set port forwarding, DMZ, uPnP, etc\dots}, what is problematic if two nodes behind 
NAT wants to communicate.

Assume two parties, A and B with addresses IP\textsuperscript{A} and IP\textsuperscript{B} respectively,
A and B are behind public NAT with addresses $\text{IP}^{\text{A}}_{\text{nat}}$ and $\text{IP}^{\text{B}}_{\text{nat}}$
respectively. By default an internal host does not known it's external address and NAT type thus technique like 
STUN\footnote{Core idea: publicly available service running on 2 IP addresses and 2 ports 
answering questions like: what is my IP address and port? Change IP address of response if I'll get it, etc...} 
is used to learn it. In case of incremental NAT it is also needed to determine $\Delta$ and the next port
that is likely to be allocated for a new connection $\text{PORT}^{\text{A}}_{\text{nat}}$ for A and $\text{PORT}^{\text{B}}_{\text{nat}}$
for B. The period between determining this information, sending to the other party and starting the algorithm is
denoted as an \emph{initialization phase} of the NAT traversal algorithm. 

UDP hole punching works as follows:
\begin{compactitem}
 \item [1.] $A: \; IP^A_{in}:PORT^A_{in} \longrightarrow IP^B_{nat}:PORT^B_{nat}$ \\
Locally a~new mapping is created ($PORT^A_{nat}$), packet is dropped on B's~NAT.
 \item [2.] $B: \; IP^A_{nat}:PORT^A_{nat} \longleftarrow  IP^B_{in}:PORT^B_{in}$ \\
Locally a~new mapping is created ($PORT^B_{nat}$), packet reaches A using allocation created in step~1.
 \item [3.] $A: \; IP^A_{in}:PORT^A_{in} \longrightarrow IP^B_{nat}:PORT^B_{nat}$ \\
Packet reaches B using allocation created in in step~2.
\end{compactitem}

% By default a packet 
% coming from the internet (\textit{IP\textsubscript{A},Port\textsubscript{A}}) to the internal 
% network is dropped on the NAT unless there is a valid mapping in NAT allocation table.

\section{Theoretical network model}
In order to evaluate algorithms in multiple environments with different parameters (workload, number of clients, etc.)
we decided to model network behavior with stochastic process. In particular we choose a Poisson process, $\{N(t), t\geq0\}$ 
that is used in queueing theory to model arrivals of requests to the server queue~\citep{Nelson:1995:PSP:207382}. 

The core idea of NAT traversal is to predict the next allocated external port by NAT, thus from this perspective 
it is important to model how NAT's internal state changes over time, i.e., how many external ports 
were allocated in a given time interval. Thus the workload is important parameter for predicting allocated port.

We model internal network connected to NAT w.r.t. newly created connections (new port allocation) as a 
time homogeneous Poisson process $Po(\lambda)$. By setting $\lambda$ we can model 
different workload of the network and evaluate algorithms with respect to the various parameters e.g., 
probability of an establishing connection. 

% Random variable $X_t \sim Po(\lambda t)$ says how many
% port allocations were made in time interval $[0,t]$

\begin{mydef}
$N(t)$ is a random variable of a number of a new port allocations made in time 
interval~$[0,t]$ where $N(t) \sim Po(\lambda t)$. \\ 
                                                      
\begin{center}                                                     
Then $P[N(t)=n] = \frac{(\lambda t)^n}{n!} e^{-\lambda t}$
\end{center}
\end{mydef}

Moreover we assume incremental NAT with $\Delta=1$ on both sides. If we sample the NAT 
state\footnote{One new STUN request to determine current port number. Creates new NAT allocation.}
each $T=10$~milliseconds the NAT state can be modeled as a random process $\{C_i | C_i \in \mathbb{N}, C_i \geq i, i\geq0\}$ where:
\[
C_i = \begin{dcases*}
         0 & if $i=0$ \\
         C_{i-1} + 1 + X_i, \; X_i \sim Po(\lambda T) & otherwise 
        \end{dcases*}
\]
Rewritten as $C_i = i + \sum_{j=1}^{i}X_i$. Expected value $E[C_i] = i + E[\sum_{j=1}^{i}X_i] = i (1+\lambda T)$.

\section{Generic algorithm structure}
Algorithms we propose have a common structure. In order to maximize probability of an establishing
a connection (i.e., success rate) it proceeds in discrete \emph{steps}. In each step it 
tries to open a new hole on it's NAT and/or to predict corresponding port allocated on the destination
NAT.

\begin{mydef}
Symmetric NAT traversal algorithm is a mapping 
$\mathcal{A}: \mathcal{U} \times \mathcal{S} \times \mathcal{M} \rightarrow \mathcal{P}_{src} \times \mathcal{P}_{dst}$, 
where \\
\begin{compactitem}
\item $\mathcal{U}=\{0,1\}$ is set of communicating parties
\item $\mathcal{S} = \{0, 1, \dots, n-1\}, \; n \in \mathbb{N}$ is a step of the algorithm
\item $\mathcal{M}$ is set of vectors of parameters of the environment (i.e., network model 
parameters and additional information obtained in initial phase). 
In our setting $\mathcal{M} = \{ (\lambda) | \lambda > 0 \}$. For simplicity $\mathcal{M} = \{ \lambda | \lambda > 0 \}$.
\item $\mathcal{P}_{src} \subseteq \mathbb{N}$ and $\mathcal{P}_{dst} \subseteq \mathbb{N}$
are sets of source and destination ports respectively
\end{compactitem}
\end{mydef}
If third parameter is not important for the algorithm it can be ignored in notation.

\paragraph{Intuition.} 
If we have $A(0,1) = (2,3)$ it means party $0$ in step $1$ sent packet from source port $2$ to destination port $3$
of the party $1$.

\paragraph{Time.} 
The algorithm proceeds in discrete time steps. Algorithm starts in time $t_0 = 0$~ms and each step $i \in \mathcal{S}$
happens in time $t_i = iT$ for some $T$. If it is not mentioned otherwise, $T = 10$~ms.

\paragraph{Party change.} 
We define unary operation on communicating parties. 
\[
a \in \mathcal{U},  \neg a = \begin{dcases*}
         0 & when $a=1$\\
         1 & when $a=0$
        \end{dcases*}
\]

\subsection{Algorithm I - baby-step, giant-step}
We propose the algorithm with high success rate for small network loads, i.e.,
$\lambda \leq 0.03, T=10$~ms. When error becomes larger,
algorithm step is not fast enough to compensate errors and thus fails for larger $\lambda$.

\begin{mydef}
Baby-step giant-step algorithm
\[
u \in \mathcal{U}, s \in \mathcal{S}: 
\mathcal{A}(u, s) = \begin{dcases*}
         (0, s)  & when $u=0$\\
         (0, 2s) & when $u=1$
        \end{dcases*}
\]
\end{mydef}

Intuitively the source port is kept constant, one side of the protocol scans ports sequentially, another
side of the protocol scans ports with step 2.

\subsection{Algorithm II - fixed destination port}
Algorithm with fixed destination port described in by \citep{Wang:2006:RSN:1156422.1156550}
changes the source port in order to create new holes in NAT in each step.

\begin{mydef}
Fixed destination port algorithm
\[
u \in \mathcal{U}, s \in \mathcal{S}: \;
\mathcal{A}(u, s) = (s, \Delta_u)
\] for some constants $\Delta_0, \Delta_1$ based on the current network workload determined in initial phase
of the protocol.
\end{mydef}

Intuitively the source port is kept constant, one side of the protocol scans ports sequentially, another
side of the protocol scans ports with step 2.

\subsection{Algorithm III - expected port value}
Some more effective algorithms can be designed if the random process the network follows is known (and their
parameters).

\begin{mydef}
Expected port value algorithm
\begin{align*}
& u \in \mathcal{U}, s \in \mathcal{S}, \lambda \in \mathcal{M}:\\
& \mathcal{A}(u, s, \lambda) = (0, s(1 + \lambda T))
\end{align*}
\end{mydef}

In step $i$ algorithm tries the expected value for $C_i$. Since the $C_i$ has unimodal distribution
the expected value is also most probable value and the algorithm uses maximum likelihood approach.

\subsection{Algorithm IV - Poisson sampling}
Algorithm with the best success rate in our simulation is based on sampling Poisson distribution.
The main idea is to let the algorithm simulate the Poisson process that the network of the
other party follows. 

\begin{mydef}
Poisson sampling algorithm 
\begin{align*}
& u \in \mathcal{U}, s \in \mathcal{S}, \lambda \in \mathcal{M}:\\
& \mathcal{A}(u, s, \lambda) = (0, \text{Poisson}(\lambda T (1+s C(\lambda)))
\end{align*} where $\text{Poisson}(\mu) = X \sim Po(\mu)$ samples Poisson distribution with
parameter $\mu$, function $C(\lambda)$ gives a constant 
coefficient\footnote{This function was found empirically by maximizing success rate}.
\end{mydef}

\section{Evaluation}
ToDo;
\begin{itemize}
 \item ToDo: algorithm success rate evaluation w.r.t. $\lambda, T$, graphs, graphs, graphs, \dots
 \item ToDo: algorithm pros/cons w.r.t. system requirements, applicability
 \item ToDo: fitting model to the real data from MU network
 \item ToDo: evaluating algorithms on real data from MU network
\end{itemize}

\section{Discussion}
ToDo; What can be done better, different settings, different $\lambda$ on both sides.

Success rate of the algorithm strongly relies on accurate measurements of the network 
properties the client resides in.  Usually 

\section{Conclusion}
ToDo; New algorithm

% -----
% Bibliography
\bibliographystyle{unsrtnat}
\bibliography{paper}

\end{multicols}



\end{document}
